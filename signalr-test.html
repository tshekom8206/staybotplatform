<!DOCTYPE html>
<html>
<head>
    <title>SignalR Notification Test</title>
    <script src="https://unpkg.com/@microsoft/signalr@latest/dist/browser/signalr.min.js"></script>
</head>
<body>
    <h1>Hostr SignalR Notification Test</h1>
    <div id="status">Connecting...</div>
    <div id="notifications"></div>

    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("http://localhost:5000/hubs/stafftask")
            .build();

        // Connection status
        connection.start().then(function () {
            document.getElementById("status").innerHTML = "‚úÖ Connected to SignalR Hub";
            console.log("Connected to SignalR Hub");
            
            // Join tenant group (replace 1 with actual tenant ID)
            connection.invoke("JoinTenantGroup", 1).then(function() {
                console.log("Joined Tenant 1 group");
                document.getElementById("status").innerHTML += "<br>‚úÖ Joined Tenant 1 group";
            });
            
        }).catch(function (err) {
            document.getElementById("status").innerHTML = "‚ùå Connection failed: " + err.toString();
            console.error(err.toString());
        });

        // Listen for task notifications
        connection.on("TaskCreated", function (notification) {
            console.log("Task Created Notification:", notification);
            addNotification("üîß Task Created", notification);
        });

        connection.on("TaskUpdated", function (notification) {
            console.log("Task Updated Notification:", notification);
            addNotification("üîÑ Task Updated", notification);
        });

        connection.on("TaskCompleted", function (notification) {
            console.log("Task Completed Notification:", notification);
            addNotification("‚úÖ Task Completed", notification);
        });

        // Listen for emergency notifications
        connection.on("EmergencyAlert", function (notification) {
            console.log("Emergency Alert:", notification);
            addNotification("üö® EMERGENCY ALERT", notification);
        });

        // Listen for maintenance notifications
        connection.on("MaintenanceRequest", function (notification) {
            console.log("Maintenance Request:", notification);
            addNotification("üîß Maintenance Request", notification);
        });

        // Listen for generic notifications
        connection.on("Notification", function (payload) {
            console.log("Generic Notification:", payload);
            addNotification("üì¢ " + payload.type.toUpperCase(), payload.data);
        });

        function addNotification(type, data) {
            const div = document.createElement("div");
            div.style.cssText = "border: 1px solid #ccc; margin: 10px; padding: 10px; background: #f9f9f9;";
            div.innerHTML = `
                <strong>${type}</strong><br>
                <strong>Time:</strong> ${new Date().toLocaleString()}<br>
                <strong>Data:</strong> <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            document.getElementById("notifications").appendChild(div);
        }
    </script>
</body>
</html>